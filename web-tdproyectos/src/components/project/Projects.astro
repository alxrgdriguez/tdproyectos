---
// Datos de los proyectos
const proyectos = [
    {
    src: "https://ik.imagekit.io/proyectostd/images/3d-models/A1.webp?tr=w-800,q-80",
    alt: "Reforma y ampliación de vivienda unifamiliar y piscina - Render 3D",
    categoria: "Reforma y Ampliación"
    },
    {
      src: "https://ik.imagekit.io/proyectostd/images/3d-models/B1.webp?tr=w-800,q-80",
      alt: "Reforma y ampliación de vivienda unifamiliar y piscina - Render 3D",
      categoria: "Reforma y Ampliación"
    },
    {
      src: "https://ik.imagekit.io/proyectostd/images/3d-models/C1.webp?tr=w-800,q-80",
      alt: "Reforma y ampliación de vivienda unifamiliar y piscina - Render 3D",
      categoria: "Reforma y Ampliación"
    },
    {
      src: "https://ik.imagekit.io/proyectostd/images/3d-models/D1.webp?tr=w-800,q-80",
      alt: "Reforma y ampliación de vivienda unifamiliar y piscina - Render 3D",
      categoria: "Reforma y Ampliación"
    },
    {
      src: "https://ik.imagekit.io/proyectostd/images/3d-models/1A.webp?tr=w-800,q-80",
      alt: "Vivienda unifamiliar y piscina - Render 3D",
      categoria: "Residencial"
    },
    {
      src: "https://ik.imagekit.io/proyectostd/images/3d-models/2A.webp?tr=w-800,q-80",
      alt: "Vivienda unifamiliar y piscina - Render 3D",
      categoria: "Residencial"
    },
    {
      src: "https://ik.imagekit.io/proyectostd/images/3d-models/3A.webp?tr=w-800,q-80",
      alt: "Pérgola para eventos - Render 3D",
      categoria: "Edificio Público"
    },
    {
      src: "https://ik.imagekit.io/proyectostd/images/3d-models/4A.webp?tr=w-800,q-80",
      alt: "Pérgola para eventos - Render 3D",
      categoria: "Edificio Público"
    },
    {
      src: "https://ik.imagekit.io/proyectostd/images/3d-models/5A.webp?tr=w-800,q-80",
      alt: "Pérgola para eventos - Render 3D",
      categoria: "Edificio Público"
    },
    {
      src: "https://ik.imagekit.io/proyectostd/images/3d-models/6A.webp?tr=w-800,q-80",
      alt: "Pérgola para eventos - Render 3D",
      categoria: "Edificio Público"
    },
    {
      src: "https://ik.imagekit.io/proyectostd/images/3d-models/7A.webp?tr=w-800,q-80",
      alt: "Pérgola para eventos - Render 3D",
      categoria: "Edificio Público"
    },
    {
      src: "https://ik.imagekit.io/proyectostd/images/3d-models/8A.webp?tr=w-800,q-80",
      alt: "Pérgola para eventos - Render 3D",
      categoria: "Edificio Público"
    }


];
---

<section 
  id="proyectos" 
  class="py-16 sm:py-20 lg:py-28 bg-white px-4 sm:px-6 lg:px-8"
>
  <!-- Encabezado mejorado -->
  <div class="max-w-7xl mx-auto text-center mb-12 lg:mb-20">
    <div class="space-y-4 sm:space-y-6">
      <h2
      class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-extrabold text-blue-900 tracking-tight mb-4 sm:mb-6"
    >
      Algunos de nuestros proyectos realizados
    </h2>
      <p class="text-base sm:text-lg lg:text-xl text-slate-600 max-w-3xl mx-auto leading-relaxed">
        Descubre nuestra experiencia en modelado 3D a través de proyectos arquitectónicos innovadores y detallados
      </p>
    </div>
  </div>

  <!-- Galería responsive mejorada -->
  <div class="max-w-7xl mx-auto">
    <div 
      id="galleryGrid"
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6 lg:gap-8"
    >
      {proyectos.map((proyecto, index) => (
        <div 
          class={`gallery-item group cursor-pointer ${index >= 4 ? 'hidden-mobile ' : ''} ${index >= 8 ? 'hidden-desktop hidden' : ''}`}
          data-index={index}
        >
          <div class="relative overflow-hidden rounded-2xl bg-white shadow-lg hover:shadow-2xl transition-all duration-500 group-hover:scale-[1.02]">
            <!-- Imagen optimizada -->
            <div class="aspect-[4/3] overflow-hidden">
              <img
                src={proyecto.src || "/placeholder.svg"}
                alt={proyecto.alt}
                loading={index < 4 ? "eager" : "lazy"}
                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                decoding="async"
              />
            </div>
            
            <!-- Overlay con información -->
            <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300">
              <div class="absolute bottom-4 left-4 right-4 text-white">
                <span class="inline-block px-3 py-1 bg-blue-500/80 backdrop-blur-sm rounded-full text-sm font-medium mb-2">
                  {proyecto.categoria}
                </span>
                <p class="text-sm leading-relaxed line-clamp-2">
                  {proyecto.alt}
                </p>
              </div>
            </div>

            <!-- Icono de zoom -->
            <div class="absolute top-4 right-4 w-10 h-10 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300 transform scale-75 group-hover:scale-100">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"/>
              </svg>
            </div>
          </div>
        </div>
      ))}
    </div>

    <!-- Botón "Ver más" mejorado -->
    <div class="text-center mt-12 lg:mt-16">
      <button
        id="showMoreBtn"
        class="group inline-flex items-center gap-3 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white font-semibold py-4 px-8 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-400/30"
        aria-label="Mostrar más proyectos"
      >
        <span id="btnText">Ver todos los modelos 3D</span>
        <svg id="btnIcon" class="w-5 h-5 transition-transform duration-300 group-hover:translate-y-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
        </svg>
      </button>
    </div>
  </div>
</section>

<!-- Modal mejorado -->
<div 
  id="modal" 
  class="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50 opacity-0 invisible transition-all duration-300"
  role="dialog"
  aria-modal="true"
  aria-labelledby="modal-title"
>
  <div class="relative max-w-6xl mx-auto p-4 w-full">
    <!-- Botón cerrar -->
    <button
      id="closeModal"
      class="absolute -top-2 right-2 sm:right-4 w-12 h-12 bg-white/10 backdrop-blur-sm text-white rounded-full flex items-center justify-center hover:bg-white/20 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-white/50 z-10"
      aria-label="Cerrar galería"
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>

    <!-- Navegación anterior -->
    <button
      id="prevBtn"
      class="absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-white/10 backdrop-blur-sm text-white rounded-full flex items-center justify-center hover:bg-white/20 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-white/50"
      aria-label="Imagen anterior"
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
    </button>

    <!-- Imagen principal -->
    <div class="flex flex-col items-center">
      <img
        id="modalImage"
        class="max-w-full max-h-[80vh] rounded-xl shadow-2xl transition-all duration-500"
        alt=""
      />
      
      <!-- Información de la imagen -->
      <div class="mt-4 text-center text-white max-w-2xl">
        <h3 id="modal-title" class="text-lg sm:text-xl font-semibold mb-2"></h3>
        <p class="text-sm sm:text-base text-white/80" id="modal-description"></p>
        <div class="mt-3 flex items-center justify-center gap-4 text-sm text-white/60">
          <span id="modal-counter"></span>
          <span id="modal-category" class="px-3 py-1 bg-white/10 rounded-full"></span>
        </div>
      </div>
    </div>

    <!-- Navegación siguiente -->
    <button
      id="nextBtn"
      class="absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-white/10 backdrop-blur-sm text-white rounded-full flex items-center justify-center hover:bg-white/20 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-white/50"
      aria-label="Siguiente imagen"
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    </button>
  </div>
</div>

<script>
  class GaleriaProyectos {
    constructor() {
      this.currentIndex = 0;
      this.proyectos = [
        {
          src: "https://ik.imagekit.io/proyectostd/images/3d-models/A1.webp?tr=w-800,q-80",
          alt: "Reforma y ampliación de vivienda unifamiliar y piscina - Render 3D",
          categoria: "Reforma y Ampliación"
        },
        {
          src: "https://ik.imagekit.io/proyectostd/images/3d-models/B1.webp?tr=w-800,q-80",
          alt: "Reforma y ampliación de vivienda unifamiliar y piscina - Render 3D",
          categoria: "Reforma y Ampliación"
        },
        {
          src: "https://ik.imagekit.io/proyectostd/images/3d-models/C1.webp?tr=w-800,q-80",
          alt: "Reforma y ampliación de vivienda unifamiliar y piscina - Render 3D",
          categoria: "Reforma y Ampliación"
        },
        {
          src: "https://ik.imagekit.io/proyectostd/images/3d-models/D1.webp?tr=w-800,q-80",
          alt: "Reforma y ampliación de vivienda unifamiliar y piscina - Render 3D",
          categoria: "Reforma y Ampliación"
        },
        {
          src: "https://ik.imagekit.io/proyectostd/images/3d-models/1A.webp?tr=w-800,q-80",
          alt: "Vivienda unifamiliar y piscina - Render 3D",
          categoria: "Residencial"
        },
        {
          src: "https://ik.imagekit.io/proyectostd/images/3d-models/2A.webp?tr=w-800,q-80",
          alt: "Vivienda unifamiliar y piscina - Render 3D",
          categoria: "Residencial"
        },
        {
          src: "https://ik.imagekit.io/proyectostd/images/3d-models/3A.webp?tr=w-800,q-80",
          alt: "Pérgola para eventos - Render 3D",
          categoria: "Edificio Público"
        },
        {
          src: "https://ik.imagekit.io/proyectostd/images/3d-models/4A.webp?tr=w-800,q-80",
          alt: "Pérgola para eventos - Render 3D",
          categoria: "Edificio Público"
        },
        {
          src: "https://ik.imagekit.io/proyectostd/images/3d-models/5A.webp?tr=w-800,q-80",
          alt: "Pérgola para eventos - Render 3D",
          categoria: "Edificio Público"
        },
        {
          src: "https://ik.imagekit.io/proyectostd/images/3d-models/6A.webp?tr=w-800,q-80",
          alt: "Pérgola para eventos - Render 3D",
          categoria: "Edificio Público"
        },
        {
          src: "https://ik.imagekit.io/proyectostd/images/3d-models/7A.webp?tr=w-800,q-80",
          alt: "Pérgola para eventos - Render 3D",
          categoria: "Edificio Público"
        },
        {
          src: "https://ik.imagekit.io/proyectostd/images/3d-models/8A.webp?tr=w-800,q-80",
          alt: "Pérgola para eventos - Render 3D",
          categoria: "Edificio Público"
        }
      ];
      
      this.init();
    }

    init() {
      this.setupInitialVisibility();
      this.bindEvents();
      this.setupIntersectionObserver();
    }

    setupInitialVisibility() {
      // En móvil: solo 4 visibles
      // En desktop: solo 8 visibles
      const isMobile = window.innerWidth < 640;
      const items = document.querySelectorAll('.gallery-item');
      
      items.forEach((item, index) => {
        if (isMobile && index >= 4) {
          item.classList.add('hidden');
        } else if (!isMobile && index >= 8) {
          item.classList.add('hidden');
        }
      });
    }

    bindEvents() {
      // Eventos de la galería
      document.querySelectorAll('.gallery-item').forEach((item, index) => {
        item.addEventListener('click', () => this.openModal(index));
        item.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            this.openModal(index);
          }
        });
        item.setAttribute('tabindex', '0');
        item.setAttribute('role', 'button');
      });

      // Botón "Ver más"
      const showMoreBtn = document.getElementById('showMoreBtn');
      if (showMoreBtn) {
        showMoreBtn.addEventListener('click', () => this.showMoreImages());
      }

      // Eventos del modal
      document.getElementById('closeModal')?.addEventListener('click', () => this.closeModal());
      document.getElementById('prevBtn')?.addEventListener('click', () => this.prevImage());
      document.getElementById('nextBtn')?.addEventListener('click', () => this.nextImage());

      // Navegación por teclado
      document.addEventListener('keydown', (e) => {
        const modal = document.getElementById('modal');
        if (!modal?.classList.contains('invisible')) {
          switch(e.key) {
            case 'Escape': this.closeModal(); break;
            case 'ArrowLeft': this.prevImage(); break;
            case 'ArrowRight': this.nextImage(); break;
          }
        }
      });

      // Cerrar modal al hacer clic fuera
      document.getElementById('modal')?.addEventListener('click', (e) => {
        if (e.target === e.currentTarget) {
          this.closeModal();
        }
      });

      // Ajustar visibilidad al cambiar tamaño de ventana
      window.addEventListener('resize', () => {
        setTimeout(() => this.setupInitialVisibility(), 100);
      });
    }

    openModal(index) {
      this.currentIndex = index;
      const modal = document.getElementById('modal');
      const modalImage = document.getElementById('modalImage');
      const proyecto = this.proyectos[index];

      if (modal && modalImage && proyecto) {
        modalImage.src = proyecto.src;
        modalImage.alt = proyecto.alt;
        
        document.getElementById('modal-title').textContent = proyecto.alt.split(' - ')[0];
        document.getElementById('modal-description').textContent = proyecto.alt;
        document.getElementById('modal-counter').textContent = `${index + 1} de ${this.proyectos.length}`;
        document.getElementById('modal-category').textContent = proyecto.categoria;

        modal.classList.remove('invisible', 'opacity-0');
        modal.classList.add('opacity-100');
        document.body.style.overflow = 'hidden';
        modal.focus();
      }
    }

    closeModal() {
      const modal = document.getElementById('modal');
      if (modal) {
        modal.classList.add('invisible', 'opacity-0');
        modal.classList.remove('opacity-100');
        document.body.style.overflow = '';
      }
    }

    prevImage() {
      this.currentIndex = (this.currentIndex - 1 + this.proyectos.length) % this.proyectos.length;
      this.updateModalImage();
    }

    nextImage() {
      this.currentIndex = (this.currentIndex + 1) % this.proyectos.length;
      this.updateModalImage();
    }

    updateModalImage() {
      const modalImage = document.getElementById('modalImage');
      const proyecto = this.proyectos[this.currentIndex];
      
      if (modalImage && proyecto) {
        modalImage.src = proyecto.src;
        modalImage.alt = proyecto.alt;
        
        document.getElementById('modal-title').textContent = proyecto.alt.split(' - ')[0];
        document.getElementById('modal-description').textContent = proyecto.alt;
        document.getElementById('modal-counter').textContent = `${this.currentIndex + 1} de ${this.proyectos.length}`;
        document.getElementById('modal-category').textContent = proyecto.categoria;
      }
    }

    showMoreImages() {
      const isMobile = window.innerWidth < 640;
      const items = document.querySelectorAll('.gallery-item.hidden');
      const showMoreBtn = document.getElementById('showMoreBtn');
      
      // Mostrar todas las imágenes ocultas
      items.forEach((item, index) => {
        setTimeout(() => {
          item.classList.remove('hidden');
          item.style.animation = 'fadeInUp 0.6s ease-out forwards';
        }, index * 100);
      });
      
      // Desaparece el botón después de mostrar todas
      setTimeout(() => {
        if (showMoreBtn) {
          showMoreBtn.style.display = 'none';
        }
      }, 300);
    }

    setupIntersectionObserver() {
      const section = document.getElementById('proyectos');
      if (section) {
        const observer = new IntersectionObserver(
          ([entry]) => {
            if (entry.isIntersecting) {
              section.style.animation = 'fadeInUp 0.8s ease-out forwards';
              observer.unobserve(section);
            }
          },
          { threshold: 0.1 }
        );
        observer.observe(section);
      }
    }
  }

  // Inicializar cuando el DOM esté listo
  document.addEventListener('DOMContentLoaded', () => {
    new GaleriaProyectos();
  });
</script>